"use strict";var testData={basic:{address:{streetAddress:"21 2nd Street",city:"New York"},phoneNumber:[{location:"home",code:44}]},starter:{name:{first:"Jack",last:"Wootton"}},array:[1,.2,"three"],objarray:{myarray:[{myitem:1}]},empty:{},glossary:{glossary:{title:"example glossary",GlossDiv:{title:"S",GlossList:{GlossEntry:{ID:"SGML",SortAs:"SGML",GlossTerm:"Standard Generalized Markup Language",Acronym:"SGML",Abbrev:"ISO 8879:1986",GlossDef:{para:"A meta-markup language, used to create markup languages such as DocBook.",GlossSeeAlso:["GML","XML"]},GlossSee:"markup"}}}}},menu:{menu:{id:"file",value:"File",popup:{menuitem:[{value:"New",onclick:"CreateNewDoc()"},{value:"Open",onclick:"OpenDoc()"},{value:"Close",onclick:"CloseDoc()"}]}}},widget:{widget:{debug:"on",window:{title:"Sample Konfabulator Widget",name:"main_window",width:500,height:500},image:{src:"Images/Sun.png",name:"sun1",hOffset:250,vOffset:250,alignment:"center"},text:{data:"Click Here",size:36,style:"bold",name:"text1",hOffset:250,vOffset:100,alignment:"center",onMouseUp:"sun1.opacity = (sun1.opacity / 100) * 90;"}}}},app=angular.module("jsonschemaV4App",["ngCookies","ngResource","ngSanitize","ngRoute","ui"]),arrayOptionsEnum={singleSchema:"singleSchema",arraySchema:"schemaArray",emptySchema:"emptySchema",anyOf:"anyOf",oneOf:"oneOf",allOf:"allOf"},idOptionsEnum={absoluteIds:"absoluteIds",relativeIds:"relativeIds",noIds:"noIds"};app.constant("Version",.1),app.constant("ArrayOptions",arrayOptionsEnum),app.constant("IDOptions",idOptionsEnum),app.constant("Specification","http://json-schema.org/draft-04/schema#");var defaultOptions={url:"http://jsonschema.net",json:testData.basic,arrayOptions:arrayOptionsEnum.singleSchema,idOptions:idOptionsEnum.noIds,includeDefaults:!1,includeEnums:!1,forceRequired:!0,numericVerbose:!1,stringsVerbose:!1,objectsVerbose:!1,arraysVerbose:!1,metadataKeywords:!1,additionalItems:!0,additionalProperties:!0},UserDefinedOptions=angular.copy(defaultOptions);app.value("UserDefinedOptions",UserDefinedOptions),app.value("defaultOptions",defaultOptions),app.config(["$routeProvider",function(a){a.when("/about",{templateUrl:"_extra_/views/about.html"}).when("/contact",{templateUrl:"_extra_/views/contact.html"}).when("/home",{templateUrl:"_extra_/views/main.html"}).when("/source",{templateUrl:"_extra_/views/source.html"}).when("/resources",{templateUrl:"_extra_/views/resources.html"}).when("/blog",{templateUrl:"_extra_/views/blog.html"}).when("/",{templateUrl:"_extra_/views/main.html"}).when("/reading",{templateUrl:"_extra_/views/reading.html"}).otherwise({redirectTo:"/main.html"})}]),angular.module("jsonschemaV4App").factory("RecursionHelper",["$compile","Schemaservice",function(a,b){var c={compile:function(c,d){var e,f=c.contents().remove();return{post:function(c,d,g){e||(e=a(f)),e(c,function(a){d.append(a)}),c.UserDefinedOptions=UserDefinedOptions,c.deleteMe=function(a){d.remove(),b.removeSchema(a)}},pre:function(a,b,c){}}}};return c}]),angular.module("jsonschemaV4App").directive("schema",["RecursionHelper",function(a){return{restrict:"E",scope:{data:"=data"},templateUrl:"_extra_/views/schema.html",compile:function(b,c){return a.compile(b,c)}}}]),angular.module("jsonschemaV4App").controller("InputController",["$scope","$log","$rootScope","Schemaservice","Utility",function(a,b,c,d,e){a.validateJSON=function(){a.inputError=!e.isValidJSON(a.json)},a.schemarize=function(){e.isValidJSON(a.json)&&(UserDefinedOptions.url=a.url,UserDefinedOptions.json=a.json,UserDefinedOptions.includeDefaults=a.includeDefaults,UserDefinedOptions.includeEnums=a.includeEnums,UserDefinedOptions.forceRequired=a.forceRequired,UserDefinedOptions.emptySchemas=a.emptySchemas,UserDefinedOptions.arrayOptions=a.arrayOptions,UserDefinedOptions.idOptions=a.idOptions,UserDefinedOptions.numericVerbose=a.numericVerbose,UserDefinedOptions.stringsVerbose=a.stringsVerbose,UserDefinedOptions.objectsVerbose=a.objectsVerbose,UserDefinedOptions.arraysVerbose=a.arraysVerbose,UserDefinedOptions.metadataKeywords=a.metadataKeywords,UserDefinedOptions.numericVerbose=a.numericVerbose,UserDefinedOptions.additionalItems=a.additionalItems,UserDefinedOptions.additionalProperties=a.additionalProperties,d.JSONString2Schema(),a.json=d.getFormattedJSON(),a.data=d.getSchemaAsPrettyString())},a.reset=function(){UserDefinedOptions=angular.copy(defaultOptions),a.inputError=!1,a.url=defaultOptions.url,a.json=angular.toJson(defaultOptions.json,!0),a.includeDefaults=defaultOptions.includeDefaults,a.includeEnums=defaultOptions.includeEnums,a.forceRequired=defaultOptions.forceRequired,a.emptySchemas=defaultOptions.emptySchemas,a.arrayOptions=defaultOptions.arrayOptions,a.idOptions=defaultOptions.idOptions,a.numericVerbose=defaultOptions.numericVerbose,a.stringsVerbose=defaultOptions.stringsVerbose,a.objectsVerbose=defaultOptions.objectsVerbose,a.arraysVerbose=defaultOptions.arraysVerbose,a.metadataKeywords=defaultOptions.metadataKeywords,a.numericVerbose=defaultOptions.numericVerbose,a.additionalItems=defaultOptions.additionalItems,a.additionalProperties=defaultOptions.additionalProperties},a.init=function(){a.reset(),a.schemarize()},a.init()}]),angular.module("jsonschemaV4App").controller("EditController",["$scope","$log","$rootScope","Schemaservice",function(a,b,c,d){a.init=function(){b.debug("EditController initializing."),a.data=d.getEditableSchema(),b.debug(a.data)},d.registerObserverCallback(a.init),a.init()}]),angular.module("jsonschemaV4App").controller("CodeController",["$scope","$log","Schemaservice",function(a,b,c){a.init=function(){b.debug("CodeController initializing."),a.data=c.getSchemaAsPrettyString()},c.registerObserverCallback(a.init),a.init()}]),angular.module("jsonschemaV4App").controller("StringController",["$scope","$log","Schemaservice",function(a,b,c){a.init=function(){b.debug("StringController initializing."),a.data=c.getSchemaAsString()},c.registerObserverCallback(a.init),a.init()}]),angular.module("jsonschemaV4App").controller("OutputController",["$scope","$rootScope","$log","$location","$anchorScroll","Schemaservice","Version",function(a,b,c,d,e,f,g){a.gotoTop=function(){d.hash("top"),e()},a.setEditView=function(){c.debug("$scope.setEditView()"),a.data=f.getSchemaAsString(),a.editSchema=!0,a.stringSchema=!1,a.codeSchema=!1},a.setStringView=function(){c.debug("$scope.setStringView()"),a.data=f.getSchemaAsString(),a.stringSchema=!0,a.editSchema=!1,a.codeSchema=!1},a.setCodeView=function(){c.debug("$scope.setCodeView()"),a.data=f.getSchemaAsPrettyString(),a.codeSchema=!0,a.editSchema=!1,a.stringSchema=!1},a.init=function(){c.debug("OutputController initializing."),a.setCodeView()},a.init()}]),angular.module("jsonschemaV4App").service("Schemaservice",["$log","Schemafactory","ArrayOptions","IDOptions","Specification","Utility",function(a,b,c,d,e,f){var g=this;this.json={},this.customModel=null,this.metaSchema={},this.editableSchema={},this.validSchema={},this.flatSchema={},this.observerCallbacks=[],this.registerObserverCallback=function(a){g.observerCallbacks.push(a)},this.notifyObservers=function(){angular.forEach(g.observerCallbacks,function(a){a()})},this.JSONString2Schema=function(){a.debug("JSON2Schema()"),g.json=angular.fromJson(UserDefinedOptions.json),this.createCustomModel(),this.createMetaSchema(),this.createIDs(),a.debug("---------------------"),a.debug(JSON.stringify(g.metaSchema,!0)),a.debug("---------------------"),this.processMetaSchema(),this.createValidSchema(),g.notifyObservers()},this.createIDs=function(){g.doCreateIDs(g.metaSchema,"")},this.doCreateIDs=function(a,b){a.___root___?a.___absolute_id___=a.__relative_id__:(a.___absolute_id___=b+"/"+a.__relative_id__,a.___parent_id___=b);var c=a.__properties__;for(var d in c)c.hasOwnProperty(d)&&g.doCreateIDs(c[d],a.___absolute_id___);var c=a.__items__;if(c&&"array"===c.__type__)for(var d in c)c.hasOwnProperty(d)&&g.doCreateIDs(c[d],a.___absolute_id___);c&&"object"===c.__type__&&g.doCreateIDs(a.__items__,a.___absolute_id___)},this.createValidSchema=function(){g.validSchema=g.doCreateValidSchema(g.metaSchema)},this.doCreateValidSchema=function(a){var b={};return angular.forEach(a,function(c,e,f){switch(String(e)){case"___absolute_id___":switch(UserDefinedOptions.idOptions){case d.absoluteIds:b.id=a.___absolute_id___;break;case d.relativeIds:b.id=a.___key___}break;case"__type__":b.type=a.__type__;break;case"__enum__":b["enum"]=a.__enum__;case"__title__":b.title=a.__title__;break;case"__description__":b.description=a.__description__;break;case"__multipleOf__":b.multipleOf=a.__multipleOf__;break;case"__exclusiveMinimum__":b.exclusiveMinimum=a.__exclusiveMinimum__;break;case"__exclusiveMaximum__":b.exclusiveMaximum=a.__exclusiveMaximum__;break;case"__maximum__":b.maximum=a.__maximum__;break;case"__minimum__":b.minimum=a.__minimum__;break;case"__minLength__":b.minLength=a.__minLength__;break;case"__required__":a.__required__.length>=1&&(b.required=a.__required__);break;case"__uniqueItems__":b.uniqueItems=a.__uniqueItems__;break;case"__default__":b["default"]=a.__default__;break;case"__properties__":if(!a.__properties__)break;b.properties={},angular.forEach(c,function(a,c,d){b.properties[c]=g.doCreateValidSchema(a)});break;case"__items__":if(!a.__items__)break;angular.isArray(a.__items__)?(b.items=[],angular.forEach(c,function(a,c,d){var e=g.doCreateValidSchema(a);b.items.push(e)})):angular.isObject(a.__items__)&&(b.items=g.doCreateValidSchema(c));break;case"__$schema__":b.$schema=a.__$schema__}}),b},this.createCustomModel=function(){var a=void 0;g.customModel=g.doCreateCustomModel(a,g.json)},this.doCreateCustomModel=function(a,c){var d=b.getInstance(a,c);return angular.forEach(c,function(a,c,e){var f=null;f=angular.isArray(a)||angular.isObject(a)?g.doCreateCustomModel(c,a):b.getInstance(c,a),d.addSubSchema(f)}),d},this.createMetaSchema=function(){g.metaSchema=g.doCreateMetaSchema(g.customModel)},this.processMetaSchema=function(){g.doProcessMetaSchema(g.metaSchema)},this.doProcessMetaSchema=function(a){angular.forEach(a,function(b,c,d){if(angular.isObject(b)&&angular.isDefined(b)){var e=g.checkIfRemoved(b);e||g.doProcessMetaSchema(b)}else g.addRequiredProperties(b,c,a)})},this.checkIfRemoved=function(a){return a.___removed___?(delete a[key],!0):!1},this.invalidObject=function(a){return!a||"object"!==a.__type__},this.addRequiredProperties=function(b,c,d){switch(String(c)){case"___required___":a.debug("addRequiredProperties("+b+", "+c+")");var e=!d.___root___;if(e){var f=Boolean(b),h=g.getSchema(d.___parent_id___);if(g.invalidObject(h))return a.debug("Invalid parent."),void a.debug(h);a.debug("Got parent."),a.debug(h);var i=d.___key___;if(f){h.__required__||(h.__required__=[]);var j=h.__required__.indexOf(i);0>j&&h.__required__.push(i)}else if(h.__required__){var j=h.__required__.indexOf(i);j>=0&&h.__required__.splice(j,1)}}}},this.makeVerbose=function(a,b){switch(a.type){case"array":UserDefinedOptions.arraysVerbose&&(b.__minItems__=1,b.__maxItems__=1e4,b.__uniqueItems__=!1,b.__additionalItems__=UserDefinedOptions.additionalItems);break;case"object":UserDefinedOptions.objectsVerbose&&(b.__additionalProperties__=!0);break;case"integer":case"number":UserDefinedOptions.numericVerbose&&(b.__multipleOf__=1,b.__maximum__=1e4,b.__minimum__=1,b.__exclusiveMaximum__=!1,b.__exclusiveMinimum__=!1);break;case"string":UserDefinedOptions.stringsVerbose&&(b.__minLength__=1);case"boolean":case"null":}UserDefinedOptions.metadataKeywords&&(b.__title__=a.title,b.__description__=a.description)},this.initObject=function(a,b){a.isObject()&&(b.__properties__={},UserDefinedOptions.additionalProperties?UserDefinedOptions.objectsVerbose&&(b.__additionalProperties__=!0):b.__additionalProperties__=!1)},this.initArray=function(a,b){if(a.isArray()){switch(UserDefinedOptions.arrayOptions){case c.emptySchema:case c.singleSchema:b.__items__={};break;case c.arraySchema:b.__items__=[]}UserDefinedOptions.additionalItems?UserDefinedOptions.arraysVerbose&&(b.__additionalItems__=!0):b.__additionalItems__=!1}},this.addDefault=function(a,b){UserDefinedOptions.includeDefaults&&(a.isObject()||a.isArray()||(b.__default__=a.defaultValue))},this.addEnums=function(a,b){UserDefinedOptions.includeEnums&&(a.isObject()||a.isArray()||(b.__enum__=[null],a.defaultValue&&b.__enum__.push(a.defaultValue)))},this.addRequired=function(a,b){b.___required___=UserDefinedOptions.forceRequired},this.setType=function(a,b){b.__type__=a.type},this.setKey=function(a,b){b.___key___=a.key},this.constructId=function(a,b){b.__relative_id__=a.id},this.setSchemaRef=function(a,b){b.___root___=a.root,a.root&&(b.__$schema__=e)},this.setParent=function(a,b){b.___parent___=a.parent},this.doCreateMetaSchema=function(a){var b={};return g.setSchemaRef(a,b),g.constructId(a,b),g.setType(a,b),g.setKey(a,b),g.makeVerbose(a,b),g.addDefault(a,b),g.addEnums(a,b),g.addRequired(a,b),g.initObject(a,b),g.initArray(a,b),angular.forEach(a.subSchemas,function(d,e){var h=g.doCreateMetaSchema(d);if(h.___parent_id___=b.__id__,a.isObject())b.__properties__[d.key]=h;else if(a.isArray())switch(UserDefinedOptions.arrayOptions){case c.emptySchema:b.__items__=f.getEmptyMetaSchema();break;case c.singleSchema:b.__items__=h;break;case c.arraySchema:a.subSchemas.length>1?b.__items__.push(h):b.__items__=h}}),b},this.removeSchemaById=function(a,b){return angular.forEach(a,function(c,d){return"___id___"==String(d)&&String(a[d])===String(b)?(a.___removed___=!0,!0):void(null!==a[d]&&"object"==f.getType(a[d])&&g.removeSchemaById(a[d],b))}),!1},this.getSchemaById=function(a,b){var c=null;if(a.___absolute_id___===b)return a;var d=a.__properties__;for(var e in d)if(d.hasOwnProperty(e)&&(c=g.getSchemaById(d[e],b)),c)break;if(c)return c;var d=a.__items__;if(d&&"object"===d.__type__&&(c=g.getSchemaById(a.__items__,b)),c)return c;if(d&&"array"===d.__type__)for(var e in d)if(d.hasOwnProperty(e)&&(c=getSchemaById(d[e],b)),c)break;return c},this.removeSchema=function(a){this.removeSchemaById(g.metaSchema,a)},this.getSchema=function(a){var b=this.getSchemaById(g.metaSchema,a);return b?b:null},this.getEditableSchema=function(){return g.metaSchema},this.formatJSON=function(a){return angular.toJson(angular.fromJson(a),!0)},this.getFormattedJSON=function(){return angular.toJson(g.json,!0)},this.getSchemaAsPrettyString=function(){var a=angular.toJson(g.validSchema,!0);return a=a.replace("_$","$")},this.getSchemaAsString=function(){var a=angular.toJson(g.validSchema,!1);return a=a.replace("_$","$")}}]),angular.module("jsonschemaV4App").factory("Schemafactory",["$log","Utility",function(a,b){var c=function(a,c){var d=!angular.isArray(c)&&!angular.isObject(c);this.root=!angular.isDefined(a),this.key=this.root?"/":String(a),this.id=this.root?UserDefinedOptions.url:String(a),this.type=b.getType(c),this.title=this.root?"Root schema.":String(a)[0].toUpperCase()+String(a).slice(1)+" schema.",this.description="An explanation about the purpose of this instance.",d&&(this.defaultValue=c),this.subSchemas=[]};return c.prototype.addSubSchema=function(a){a.parent=this,this.subSchemas.push(a)},c.prototype.isObject=function(a){return"object"===this.type},c.prototype.isArray=function(a){return"array"===this.type},c.prototype.isString=function(a){return"string"===this.type},c.prototype.isNumber=function(a){return"number"===this.type},c.prototype.isInteger=function(a){return"integer"===this.type},{getInstance:function(a,b){return new c(a,b)}}}]),angular.module("jsonschemaV4App").service("Utility",function(){this.getType=function(a){var b;if(angular.isArray(a))b="array";else if(angular.isObject(a))b="object";else if(angular.isNumber(a)){var c=a%1===0;b=c?"integer":"number"}else angular.isString(a)?b="string":null===a?b="null":"boolean"==typeof a&&(b="boolean");return b},this.isValidJSON=function(a){try{angular.fromJson(a)}catch(b){return!1}return!0},this.getEmptyMetaSchema=function(){var a={},b="auto-generated-schema-"+Math.floor(1e3*Math.random()+1);return a.___key___=b,a.__id__=b,UserDefinedOptions.metadataKeywords&&(a.__title__=String(b)[0].toUpperCase()+String(b).slice(1)+" schema.",a.__description__="An explanation about the puropose of this instance.",a.__name__=String(b)),a}});